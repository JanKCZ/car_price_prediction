<!DOCTYPE html>
<html lang="cs">
<head>
	<meta charset="UTF8">
	<title>Car price prediction</title>
	<script type="text/javascript"
         src="{{ url_for('static', filename='data.js') }}">
    </script>
	<script type="text/javascript"
		href="static/data.js">
	</script>
    <script type="text/javascript"
         src="{{ url_for('static', filename='methods.js') }}">
    </script>
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/style.css') }}"/>
	<!-- <link rel="stylesheet" href="static/styles/style.css"/> -->
	<!-- <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"> -->
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">
</head>
<body>
	<header>
		<h1>
			Predikce cen automobilů
		</h1>
		<h4>
			Strojové učení, konkrétně neuronová síť (dále jen NS) je zde využita k "vstřebání" informací z více jak 40 tisíc inzerátů automobilů. Výsledkem je model NS, který umožňuje odhadovat cenu utomobilu na základě jakýchkoliv vstupních dat.
			<div class="ttHeading"><i class="material-icons" style="font-size:20px; vertical-align: -5px;">info</i>
				<span class="ttHeadingText">NS nekontroluje, zda-li může mít např. Porsche 911 osm míst a jeden airbag, ale odhadne, jaká by byla jeho hodnota s ohledem na výrobce, model a další parametry vozidla.</span>
			</div>
		</h4>
		<br>
	</header>
	<main>
		<form>
			<table>
				<tr>
					<td>
						Výrobce: 
					</td>
					<td>
						<select
							id="car_brand_list">
							<option value="" disabled selected> -- vyberte jednu z možností -- </option>
						</select>
					</td>
				</tr>
				<tr>
					<td>
						Model: 
					</td>
					<td>
						<select 
							id="car_model_list">
							<option value="" disabled selected> -- jako první zvolte výrobce -- </option>
						</select>
					</td>
				</tr>
				<tr>
					<td>
						Karoserie: 
					</td>
					<td>
						<select 
							id="car_type_list">
							<option disabled selected value > -- vyberte jednu z možností -- </option>
						</select>
					</td>
				</tr>
				<tr>
					<td>
						Výkon v kW:
					</td>
					<td>
						<input type="text" id="engine_power" name="engine_power" required minlength="1" maxlength="3" placeholder="například 90" onkeypress="return (event.charCode !=8 && event.charCode ==0 || (event.charCode >= 48 && event.charCode <= 57))">
					</td>
				</tr>
				<tr>
					<td>
						Stav: 
					</td>
					<td>
						<select
						id="condition">
							<option disabled selected value > -- vyberte jednu z možností -- </option>
							<option value="nové">Nové</option>
							<option value="předváděcí">Předváděcí</option>
							<option value="ojeté">Ojeté</option>
						</select>
					</td>
				</tr>
				<tr>
					<td>
						Servisní knížka: 
					</td>
					<td>
						<select
						id="book">
							<option disabled selected value > -- vyberte jednu z možností -- </option>
							<option value="ano">Ano</option>
							<option value="ne">Ne</option>
						</select>
					</td>
				</tr>
				<tr>
					<td>
						Rok výroby (min 2010):
					</td>
					<td>
						<input type="number" id="year" name="year" min = 2010 max = 2021 equired minlength="4" maxlength="4" placeholder="například 2015" onkeypress="return (event.charCode !=8 && event.charCode ==0 || (event.charCode >= 48 && event.charCode <= 57))">
						<div class="ttYear"><i class="material-icons" style="font-size:20px; vertical-align: -5px;">info</i>
							<span class="ttYearText">Zadejte rok výroby 2010 a novější</span>
						</div>
					</td>

				</tr>
				<tr>
					<td>
						Počet najetých km:
					</td>
					<td>
						<input type="text" id="milage" name="milage" required minlength="1" maxlength="6" placeholder="například 150000" onkeypress="return (event.charCode !=8 && event.charCode ==0 || (event.charCode >= 48 && event.charCode <= 57))">
					</td>
				</tr>
				<tr>
					<td>
						Palivo: 
					</td>
					<td>
						<select
							id="car_fuel_list"> 
							<option disabled selected value > -- vyberte jednu z možností -- </option>
						</select>
					</td>
				</tr>
				<tr>
					<td>
						Počet míst k sezení: 
					</td>
					<td>
						<input type="text" id="n_ppl_list" name="n_ppl_list" required minlength="1" maxlength="1" placeholder="například 5" onkeypress="return (event.charCode !=8 && event.charCode ==0 || (event.charCode >= 48 && event.charCode <= 57))">
					</td>
				</tr>
				<tr>
					<td>
						Počet airbagů: 
					</td>
					<td>
						<input type="text" id="n_airbags_list" name="n_airbags_list" required minlength="1" maxlength="2" placeholder="například 12" onkeypress="return (event.charCode !=8 && event.charCode ==0 || (event.charCode >= 48 && event.charCode <= 57))">
					</td>
				</tr>
				<tr>
					<td>
						Počet dveří: 
					</td>
					<td>
						<input type="text" id="n_doors_list" name="n_doors_list" required minlength="1" maxlength="1" placeholder="například 5" onkeypress="return (event.charCode !=8 && event.charCode ==0 || (event.charCode >= 48 && event.charCode <= 57))">
					</td>
				</tr>
				<tr>
					<td>
						Klimatizace: 
					</td>
					<td>
						<select 
							id="air_condition_list">
							<option disabled selected value > -- vyberte jednu z možností -- </option>
						</select>
					</td>
				</tr>
				<tr>
					<td>
						Převodovka: 
					</td>
					<td>
						<select 
							id="transmission_list">
							<option disabled selected value > -- vyberte jednu z možností -- </option>
						</select>
					</td>
				</tr>
				<tr>
					<td>
						Země původu: 
					</td>
					<td>
						<select 
							id="country_list">
							<option disabled selected value > -- vyberte jednu z možností -- </option>
						</select>
					</td>
				</tr>
				<tr>
					<td>
						Výbava: 
					</td>
					<td>
						<select 
							id="extras_list">
							<option disabled selected value > -- vyberte jednu z možností -- </option>
							<option value="1">Minimální</option>
							<option value="2">Standardní</option>
							<option value="3">Prémiová</option>
							<option value="4">Exkluzivní</option>
						</select>
							<div class="ttExtras"><i class="material-icons" style="font-size:20px; vertical-align: -5px;">info</i>
								<span class="ttExtrasText">Vyberte možnost, která se nejvíce přibližuje výbavě nabízené u Vašeho modelu.</span>
							</div>
					</td>
				</tr>
			</table>
		</form>
	</main>
	<br>
	<div class="login">
    <form action="{{ url_for('predict')}}"method="POST" onsubmit="return passParametres()">
    	<input id = "car_brand_input" type = "hidden" name = "car_brand_input" value = "" />
    	<input id = "car_model_input" type = "hidden" name = "car_model_input" value = "" />
    	<input id = "car_type_input" type = "hidden" name = "car_type_input" value = "" />
    	<input id = "engine_power_input" type = "hidden" name = "engine_power_input" value = "" />
    	<input id = "condition_input" type = "hidden" name = "condition_input" value = "" />
    	<input id = "service_book_input" type = "hidden" name = "service_book_input" value = "" />
    	<input id = "year_input" type = "hidden" name = "year_input" value = "" />
    	<input id = "milage_input" type = "hidden" name = "milage_input" value = "" />
    	<input id = "fuell_input" type = "hidden" name = "fuell_input" value = "" />
    	<input id = "n_ppl_input" type = "hidden" name = "n_ppl_input" value = "" />
    	<input id = "n_airbags_input" type = "hidden" name = "n_airbags_input" value = "" />
    	<input id = "n_doors_input" type = "hidden" name = "n_doors_input" value = "" />
    	<input id = "aircondition_input" type = "hidden" name = "aircondition_input" value = "" />
    	<input id = "transmission_input" type = "hidden" name = "transmission_input" value = "" />
    	<input id = "country_input" type = "hidden" name = "country_input" value = "" />
    	<input id = "extras_input" type = "hidden" name = "extras_input" value = "" />
        <button type="submit" name="submit" id="submitBtn"
        	class="btn">Odhadnout cenu</button>
        <td>
        	<h3>
				{{pred}}
			</h3>
        </td>
    </form>
	</div>
	<br>
	<div>
		<b>
			Proč strojového učení:
		</b>
		<br>
		<b1>
			Strojové učení je učení v pravém slova smyslu, není zde žádný zdrojový kód, který by zohledňoval každou variantu a každou z milionu kombinací. Algoritmus je schopen se s relativní přeností naučit odhadovat téměř jakékoliv hodnoty, odhalit anomálie, rozpoznat obrázek, anebo například naučit se hrát počítačovou hru. Tento projekt vznikl jako jednoduchá prezentace užitku strojového učení.<br>
		</b1>
	</div>
	<br>
	<div>
		<b>
			Odchylky od reálné tržní ceny:
		</b>
		<br>
		<b1>
			Zdrojovými daty jsou inzeráty automobilů, které jsou vkládány autobazary, anebo lidmi postrádající potřebné znalosti k odhadnutí ceny. Může proto docházet k účelnému anebo nechtěnému pozměnění prodejní ceny oproti ceně tržní (jako např. například "sleva" při využití půjčky, popřípadě očekávaný tlak na slevu ze strany zájemce).<br> 1. Všechny tyto odchylky od skutečné tržní ceny jsou alogritmem absorvovány a naučeny.<br>
			2. Pokud jsou tedy vstupní data nepřesná, nelze ani od neuronové sítě očekávat 100% přesný odhad.<br>
			3. U automobilů vyrobených před rokem 2010 docházelo k vysoké deformaci odhadované ceny. Po analýze vstupních dat bylo zjištěno, že tyto automobily mají více skrytých vad plynoucích z opotřebení, apod. Z tohoto důvodu nebyly na učení použity inzeráty těchto automobilů.
		</b1>
	</div>
	<br>
	<div>
		<b>
			Specifikace neuronové sítě:
		</b>
		<br>
		<b1>
			5 skrytých vrstev po 800 neuronech, dropout 0.3, alfa 0.01, batch 32, gradient Adam, activační funkce ReLu, knihovna Scikit-learn MLPRegressor<br>
			Neuronová síť v tomto případě dosahuje výrazně lepších výsledků než RFR, XGBoost a ostatní regresní metody.
		</b1>
	</div>
	<br>
	<div>
		<b>
			Upozornění:
		</b>
		<br>
		<b1>
			Vypočtená cena neslouží jako referenční hodnota vozidla a její využítí je pouze na vlastní odpovědnost.
		</b1>
	</div>
	<br>
	<br>
	<address>
		Kontakt <a href="mailto:jan.kolnik@gmail.com">jan.kolnik@gmail.com</a>.<br> 
	</address>
</body>
	<script>
		//VARIABLES
		var car_brand
		var car_model

		//CAR BRAND and MODEL
		var car_brand_Object = Object.keys(car_brand_model_dict);
		var select_brand_list = document.getElementById("car_brand_list");
		for(index in car_brand_Object) {
   	 		select_brand_list.options[select_brand_list.options.length] = new Option(car_brand_Object[index], index);
		}

		var select_model_list = document.getElementById("car_model_list");

		function clear_list() {
			var i, L = select_model_list.options.length - 1;
		    for(i = L; i >= 0; i--) {
		      select_model_list.remove(i);
		   	}
		}

		select_brand_list.addEventListener("change", function() {
			car_brand = Object.keys(car_brand_model_dict)[select_brand_list.value];
			clear_list();
			display_car_models(car_brand);
		})

		function display_car_models(car_brand) {
			var car_model_Object = car_brand_model_dict[car_brand];
			for(index in car_model_Object) {
   	 			select_model_list.options[select_model_list.options.length] = new Option(car_model_Object[index], index);
			}
		}

		function load_data_to_list(elementID, data, sort) {
			var list = document.getElementById(elementID);
			for(var i = 0; i < data.length; i++) {
				if (sort == true) {
					var opt = data.sort()[i];
				    var el = document.createElement("option");
				    el.text = opt;
				    el.value = opt;
				    list.add(el);
				} else {
					var opt = data[i];
				    var el = document.createElement("option");
				    el.text = opt;
				    el.value = opt;
				    list.add(el);
				}	
			}
		}

		//FUEL
		load_data_to_list("car_fuel_list", fuell_data, false);

		//TRANSMISSION
		load_data_to_list("transmission_list", transmission_data, true);

		//AIRCONDITION
		load_data_to_list("air_condition_list", air_condition_data, false);

		//COUNTRY
		load_data_to_list("country_list", country_data, false);

		//CAR TYPE
		load_data_to_list("car_type_list", car_type_data, true);
	</script>
</html>